<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Computer Maintenance Scheduler</title>
<style>
body{font-family:Arial;background:#f4f4f9;display:flex;justify-content:center;padding:20px;}
.container{background:white;padding:25px;border-radius:12px;box-shadow:0 4px 8px rgba(0,0,0,0.1);width:100%;max-width:420px;}
h2{text-align:center;}
label{margin-top:10px;display:block;font-weight:bold;}
input,select,textarea,button{width:100%;padding:10px;margin-top:5px;border-radius:6px;border:1px solid #ccc;font-size:15px;}
button{background:#4CAF50;color:white;border:none;cursor:pointer;margin-top:15px;}
.cancel{background:#f44336;}
.deleteBtn{background:#333;margin-top:8px;color:white;border:none;padding:8px;border-radius:4px;cursor:pointer;}
.task-list{margin-top:20px;}
.task-item{background:#e9e9ff;padding:12px;margin-bottom:10px;border-radius:8px;font-size:14px;border-left:4px solid #4CAF50;}
.empty-state{color:#666;text-align:center;padding:20px;font-style:italic;}
.notification-status{font-size:12px;color:#666;text-align:center;margin-top:5px;}
@media(max-width:500px){body{padding:10px;}.container{padding:18px;}input,select,textarea,button{font-size:16px;}}
</style>
</head>
<body>
<div class="container">
<h2>Schedule Maintenance</h2>
<div class="notification-status" id="notifStatus">Notifications: Checking...</div>

<form id="maintenanceForm">
<label>Computer Unit</label>
<select id="computer" required>
<option value="">Select Computer</option>
<option>PC-01</option>
<option>PC-02</option>
<option>PC-03</option>
<option>PC-04</option>
<option>PC-05</option>
</select>

<label>Date</label>
<input type="date" id="date" required>

<label>Time</label>
<input type="time" id="time" required>

<label>Maintenance Type</label>
<select id="type" required>
<option value="">Select Type</option>
<option>Cleaning</option>
<option>Software Update</option>
<option>Hardware Check</option>
<option>Troubleshooting</option>
</select>

<label>Technician</label>
<input type="text" id="technician" required>

<label>Notes</label>
<textarea id="notes"></textarea>

<button type="submit">Save Task</button>
<button type="button" class="cancel" onclick="resetForm()">Cancel</button>
</form>

<div class="task-list" id="taskList">
<h3>Upcoming Tasks (<span id="taskCount">0</span>)</h3>
</div>
</div>

<script>
// Notification Setup
const notifStatus = document.getElementById("notifStatus");

if("Notification" in window){
    Notification.requestPermission().then(permission => {
        notifStatus.textContent = "Notifications: " + permission;
        notifStatus.style.color = permission === "granted" ? "green" : "orange";
    });
} else {
    notifStatus.textContent = "Notifications: Not supported";
    notifStatus.style.color = "red";
}

const form = document.getElementById("maintenanceForm");
const taskList = document.getElementById("taskList");
const taskCount = document.getElementById("taskCount");

let schedules = JSON.parse(localStorage.getItem("schedules")) || [];

// Debug: Log what's loaded
console.log("App started. Schedules:", schedules);

// LOAD SAVED TASKS
displayTasks();

// SAVE TASK
form.addEventListener("submit", function(e){
    e.preventDefault();
    
    let computer = document.getElementById("computer").value;
    let date = document.getElementById("date").value;
    let time = document.getElementById("time").value;
    let type = document.getElementById("type").value;
    let technician = document.getElementById("technician").value;
    let notes = document.getElementById("notes").value;
    
    // Conflict Check
    for(let s of schedules){
        if(s.computer === computer && s.date === date && s.time === time){
            alert("Schedule Conflict! This computer already has maintenance at this time.");
            return;
        }
    }
    
    let newTask = {
        id: Date.now(), // Unique ID
        computer,
        date,
        time,
        type,
        technician,
        notes,
        notified: false,
        created: new Date().toISOString()
    };
    
    schedules.push(newTask);
    saveAndRefresh();
    form.reset();
    
    // Visual feedback
    alert("Task saved successfully!");
});

function saveAndRefresh(){
    localStorage.setItem("schedules", JSON.stringify(schedules));
    displayTasks();
    console.log("Saved. Total tasks:", schedules.length);
}

// DISPLAY TASKS
function displayTasks(){
    const header = "<h3>Upcoming Tasks (" + schedules.length + ")</h3>";
    
    if(schedules.length === 0){
        taskList.innerHTML = header + '<div class="empty-state">No tasks scheduled. Add one above!</div>';
        taskCount.textContent = "0";
        return;
    }
    
    taskList.innerHTML = header;
    
    // Sort by date/time
    schedules.sort((a,b) => new Date(a.date + "T" + a.time) - new Date(b.date + "T" + b.time));
    
    schedules.forEach((task, index) => {
        let div = document.createElement("div");
        div.className = "task-item";
        
        let taskDate = new Date(task.date + "T" + task.time);
        let isPast = taskDate < new Date();
        let statusBadge = isPast ? '<span style="color:red">[OVERDUE]</span>' : '';
        let notifiedBadge = task.notified ? '<span style="color:green">[NOTIFIED]</span>' : '';
        
        div.innerHTML = `
            <strong>${task.computer}</strong> ${statusBadge} ${notifiedBadge}<br>
            <strong>Type:</strong> ${task.type}<br>
            <strong>When:</strong> ${task.date} at ${task.time}<br>
            <strong>Technician:</strong> ${task.technician}<br>
            ${task.notes ? `<strong>Notes:</strong> ${task.notes}<br>` : ''}
            <button class="deleteBtn" onclick="deleteTask(${index})">Delete</button>
        `;
        taskList.appendChild(div);
    });
    
    taskCount.textContent = schedules.length;
}

// DELETE TASK
function deleteTask(index){
    if(confirm("Delete this task?")){
        schedules.splice(index, 1);
        saveAndRefresh();
    }
}

// RESET FORM
function resetForm(){
    form.reset();
}

// NOTIFICATION CHECKER - Every 10 seconds (for testing)
setInterval(function(){
    let now = new Date();
    let changes = false;
    
    schedules.forEach(task => {
        let taskTime = new Date(task.date + "T" + task.time);
        
        // Notify if within 1 minute past scheduled time and not notified yet
        if(now >= taskTime && !task.notified && now - taskTime < 60000){
            if(Notification.permission === "granted"){
                new Notification("ðŸ”§ Maintenance Due!", {
                    body: `${task.computer} - ${task.type} maintenance is scheduled now`,
                    icon: "https://cdn-icons-png.flaticon.com/512/3063/3063822.png",
                    requireInteraction: true
                });
            }
            task.notified = true;
            changes = true;
            console.log("Notification sent for:", task.computer);
        }
    });
    
    if(changes){
        saveAndRefresh();
    }
}, 10000); // Check every 10 seconds

// Initial display
displayTasks();
</script>
</body>
</html>
